<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<title>Irene Desktop Guardian</title>
<style>
body{background:#000;color:#d4af37;font-family:Arial;margin:0;padding:20px;}
h1{margin-top:0;}
.grid{display:grid;grid-template-columns:2fr 2fr;gap:20px;margin-top:20px;}
.card{background:#070707;border:1px solid #333;border-radius:12px;padding:15px;box-shadow:0 0 12px #111;}
.card h3{margin:0 0 8px 0;font-size:15px;}
.small{font-size:11px;color:#888;}
pre{background:#050505;border:1px solid #222;border-radius:8px;padding:10px;font-size:11px;max-height:220px;overflow:auto;}
button{background:#d4af37;color:#000;border:none;padding:8px 12px;border-radius:6px;font-weight:bold;cursor:pointer;margin-right:5px;margin-top:5px;}
button:hover{filter:brightness(1.07);}
ul{margin:0;padding-left:18px;max-height:220px;overflow:auto;font-size:11px;}
.badge{display:inline-block;background:#111;border-radius:6px;padding:3px 6px;font-size:11px;margin-right:5px;}
</style>
</head>
<body>
<h1>Irene Desktop Guardian</h1>
<p class='small'>Local-only console. Irene supervises your PC and project without touching payments or external APIs.</p>

<div class='grid'>
  <div class='card'>
    <h3>System Overview</h3>
    <div id='sys'></div>
    <button onclick='loadSys()'>Refresh</button>
    <span class='badge' id='quick-status'>-</span>
  </div>
  <div class='card'>
    <h3>Project Structure (Top Level)</h3>
    <ul id='tree'></ul>
    <button onclick='loadTree()'>Reload Tree</button>
  </div>
</div>

<div class='grid'>
  <div class='card'>
    <h3>Logs Viewer</h3>
    <select id='logsel'>
      <option value='logs/auto_tasks.log'>auto_tasks.log</option>
      <option value='logs/firewall.log'>firewall.log</option>
      <option value='logs/orchestrator/orchestrator.log'>orchestrator.log</option>
      <option value='logs/secops/secops.log'>secops.log</option>
    </select>
    <button onclick='loadLog()'>View</button>
    <pre id='log'></pre>
  </div>
  <div class='card'>
    <h3>Quick Actions (Local Only)</h3>
    <button onclick='openProj()'>Open Project Folder</button><br>
    <button onclick='openLogs()'>Open Logs Folder</button><br>
    <button onclick='quickCheck()'>Quick Check</button>
    <pre id='actions'></pre>
  </div>
</div>

<script>
async function loadSys(){
  const res = await fetch('/api/desktop/info');
  const d = await res.json();
  if(!d.ok){ document.getElementById('sys').textContent = 'Error'; return; }
  const s = d.data;
  document.getElementById('sys').innerHTML =
    'User: '+s.user+'<br>'+
    'Host: '+s.host+'<br>'+
    'Platform: '+s.platform+'<br>'+
    'CPUs: '+s.cpus+'<br>'+
    'Project: '+s.projectRoot;
}

async function loadTree(){
  const res = await fetch('/api/desktop/project');
  const d = await res.json();
  const ul = document.getElementById('tree');
  ul.innerHTML = '';
  if(!d.ok || !d.tree) return;
  d.tree.forEach(item=>{
    if(item.depth <= 1){
      const li = document.createElement('li');
      li.textContent = (item.dir ? '[DIR] ' : '[FILE] ') + item.path.replace('C:\\\\NeuralGPT.Store','.');
      ul.appendChild(li);
    }
  });
}

async function loadLog(){
  const p = document.getElementById('logsel').value;
  const res = await fetch('/api/desktop/log',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({path:p})
  });
  const d = await res.json();
  document.getElementById('log').textContent = d.text || 'No data';
}

async function openProj(){
  const res = await fetch('/api/desktop/open_project',{method:'POST'});
  const d = await res.json();
  document.getElementById('actions').textContent = 'Open project: '+(d.ok?'OK':'ERROR');
}

async function openLogs(){
  const res = await fetch('/api/desktop/open_logs',{method:'POST'});
  const d = await res.json();
  document.getElementById('actions').textContent = 'Open logs: '+(d.ok?'OK':'ERROR');
}

async function quickCheck(){
  const res = await fetch('/api/desktop/quick_check');
  const d = await res.json();
  document.getElementById('actions').textContent = JSON.stringify(d,null,2);
  const badge = document.getElementById('quick-status');
  badge.textContent = 'Server: '+(d.data && d.data.ok!==false ? 'OK' : 'CHECK');
}

loadSys();
loadTree();
</script>
<script src='/js/lazyload.js'></script></body>
</html>

