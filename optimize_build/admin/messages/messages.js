async function load(){ const r = await fetch('/api/messages/list'); const data = await r.json(); const box = document.getElementById('inbox'); box.innerHTML=''; data.list.forEach(m=>{ const div = document.createElement('div'); div.className='msg'+(m.read?'':' unread'); div.innerHTML='<b>'+m.from+'</b> â†’ '+m.to+'<br>'+m.msg+ '<br><small>'+new Date(m.created).toLocaleString()+'</small>'+ '<br><button onclick=\"markRead(\\''+m.id+'\\')\">Marcar leÃ­do</button>'; box.appendChild(div); }); } async function sendMsg(){ const body = { from: document.getElementById('from').value, to: document.getElementById('to').value, msg: document.getElementById('msg').value }; await fetch('/api/messages/send',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) }); load(); } async function markRead(id){ await fetch('/api/messages/read',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({id}) }); load(); } load(); 
